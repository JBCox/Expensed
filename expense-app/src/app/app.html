<ng-container *ngIf="vm$ | async as vm">
<!-- Top Bar - Show only for regular authenticated users (not auth routes or super-admin routes) -->
<mat-toolbar *ngIf="vm.isAuthenticated && !isAuthRoute && !isSuperAdminRoute" class="app-toolbar">
  <div class="toolbar-content">
    <!-- Left Section: Hamburger + Logo -->
    <div class="toolbar-left">
      <button mat-icon-button class="hamburger-button" (click)="toggleSidebar()" aria-label="Toggle sidebar">
        <mat-icon>menu</mat-icon>
      </button>
      <div class="logo-section">
        <app-brand-logo [size]="56" [showOrgLogoInput]="true"></app-brand-logo>
      </div>
    </div>

    <!-- Center Section: Search Placeholder -->
    <div class="toolbar-center">
      <div class="search-placeholder">
        <mat-icon>search</mat-icon>
        <span>Search expenses...</span>
      </div>
    </div>

    <!-- Right Section: Notifications + User Menu -->
    <div class="toolbar-right">
      <app-notification-center></app-notification-center>

      <button mat-icon-button [matMenuTriggerFor]="userMenu" aria-label="User menu">
        <mat-icon>account_circle</mat-icon>
      </button>
      <mat-menu #userMenu="matMenu">
        <div class="user-info" mat-menu-item disabled>
          <div class="user-name">{{ vm.displayName }}</div>
          <div class="user-email">{{ vm.email }}</div>
        </div>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="toggleTheme()">
          <mat-icon>{{ themeService.theme() === 'dark' ? 'light_mode' : 'dark_mode' }}</mat-icon>
          <span>{{ themeService.theme() === 'dark' ? 'Light Mode' : 'Dark Mode' }}</span>
        </button>
        <button mat-menu-item (click)="signOut()">
          <mat-icon>logout</mat-icon>
          <span>Sign Out</span>
        </button>
      </mat-menu>
    </div>
  </div>
</mat-toolbar>

<!-- Sidebar Navigation - Hide for super-admin routes (they have their own sidebar) -->
<app-sidebar-nav
  *ngIf="vm.isAuthenticated && !isAuthRoute && !isSuperAdminRoute"
  [isOpen]="isSidebarOpen"
  (closeSidebar)="closeSidebar()"
  (collapsedChange)="onSidebarCollapsedChange($event)">
</app-sidebar-nav>

<!-- Main Content Area -->
<div
  class="app-content"
  [class.jensify-premium-mesh-bg]="!isSuperAdminRoute"
  [class.with-toolbar]="vm.isAuthenticated && !isAuthRoute && !isSuperAdminRoute"
  [class.with-sidebar]="vm.isAuthenticated && !isAuthRoute && !isSuperAdminRoute"
  [class.sidebar-collapsed]="isSidebarCollapsed && !isSuperAdminRoute"
  [class.super-admin-mode]="isSuperAdminRoute">
  <!-- Breadcrumbs - Hide for super-admin routes -->
  <app-breadcrumbs *ngIf="vm.isAuthenticated && !isAuthRoute && !isSuperAdminRoute"></app-breadcrumbs>

  <router-outlet />
</div>
</ng-container>

<!-- PWA Components (always visible) -->
<app-offline-indicator />
<app-install-prompt />
