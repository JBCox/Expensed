<!-- Backdrop for mobile -->
<div
  class="sidebar-backdrop"
  [class.active]="isOpen"
  (click)="onBackdropClick()"
  (keydown.enter)="onBackdropClick()"
  tabindex="-1"
  role="button"
  aria-label="Close sidebar"
>
</div>

<!-- Sidebar -->
<aside
  class="sidebar"
  [class.expanded]="!collapsed()"
  [class.collapsed]="collapsed()"
  [class.open]="isOpen"
>
  <!-- Organization Display -->
  <div class="sidebar-top">
    <div class="sidebar-org-switcher">
      <app-org-switcher></app-org-switcher>
    </div>
  </div>

  <nav class="sidebar-nav">
    <div
      *ngFor="let item of filteredNavItems; trackBy: trackByNavItemRoute"
      class="nav-item"
      [class.active]="isActive(item.route)"
      (click)="navigate(item.route)"
      (keydown.enter)="navigate(item.route)"
      tabindex="0"
      role="button"
      [attr.aria-label]="item.label | translate"
    >
      <mat-icon class="nav-icon">{{ item.icon }}</mat-icon>
      <span class="nav-label" *ngIf="!collapsed()">{{ item.label | translate }}</span>
      <!-- Badges for key routes -->
      <span class="nav-badge" *ngIf="!collapsed()">
        <ng-container [ngSwitch]="item.route">
          <ng-container *ngSwitchCase="'/expenses'">
            <ng-container *ngIf="(unreportedCount$ | async) as count">
              <span class="badge" *ngIf="count > 0">{{ count }}</span>
            </ng-container>
          </ng-container>
          <ng-container *ngSwitchCase="'/reports'">
            <ng-container *ngIf="(draftReportsCount$ | async) as count">
              <span class="badge" *ngIf="count > 0">{{ count }}</span>
            </ng-container>
          </ng-container>
          <ng-container *ngSwitchCase="'/approvals'">
            <ng-container *ngIf="(pendingApprovalCount$ | async) as count">
              <span class="badge" *ngIf="count > 0">{{ count }}</span>
            </ng-container>
          </ng-container>
        </ng-container>
      </span>
    </div>
  </nav>
  <div class="sidebar-footer">
    <button
      mat-icon-button
      class="collapse-toggle"
      (click)="toggleCollapse()"
      [attr.aria-label]="collapsed() ? ('nav.expandSidebar' | translate) : ('nav.collapseSidebar' | translate)"
      [matTooltip]="collapsed() ? ('nav.expand' | translate) : ('nav.collapse' | translate)"
      matTooltipPosition="right"
    >
      <mat-icon>{{ collapsed() ? 'chevron_right' : 'chevron_left' }}</mat-icon>
    </button>
  </div>
</aside>
