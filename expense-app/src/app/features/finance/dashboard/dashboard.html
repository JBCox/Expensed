<div class="jensify-container">
  <div class="jensify-page-header">
    <div class="jensify-header-content">
      <h1 class="jensify-page-title">Finance Dashboard</h1>
      <p class="jensify-page-subtitle">Approved reports waiting for reimbursement</p>
    </div>
    <button mat-stroked-button class="jensify-export-btn" (click)="exportToCSV()">
      <mat-icon>download</mat-icon>
      Export CSV
    </button>
  </div>

  <div class="jensify-metrics-grid">
    <app-metric-card
      [value]="totalPending().toString()"
      label="Reports Pending"
      icon="pending_actions"
      iconType="pending">
    </app-metric-card>

    <app-metric-card
      [value]="formatCurrency(totalAmount())"
      label="Total Amount"
      icon="payments"
      iconType="spend">
    </app-metric-card>
  </div>

  @if (selectedCount() > 0) {
    <div class="jensify-batch-action-bar">
      <span class="jensify-selection-count">{{ selectedCount() }} selected</span>
      <button mat-raised-button class="jensify-reimbursed-btn" (click)="markAllAsPaid()">
        <mat-icon>paid</mat-icon>
        Mark Selected Reimbursed
      </button>
    </div>
  }

  @if (loading()) {
    <app-loading-skeleton />
  }

  @if (error() && !loading()) {
    <mat-card class="jensify-card error-card">
      <mat-icon>error</mat-icon>
      <p>{{ error() }}</p>
      <button mat-raised-button color="primary" (click)="loadApprovedReports()">Retry</button>
    </mat-card>
  }

  @if (!loading() && !error() && approvedReports().length === 0) {
    <app-empty-state
      icon="check_circle"
      title="All paid up"
      message="No approved reports awaiting reimbursement.">
    </app-empty-state>
  }

  @if (!loading() && !error() && approvedReports().length > 0) {
    <mat-card class="jensify-card">
      <div class="jensify-report-list">
        @for (report of approvedReports(); track trackByReportId($index, report)) {
          <div class="jensify-report-row" (click)="toggleSelection(report.id)">
            <mat-checkbox
              [checked]="isSelected(report.id)"
              (click)="$event.stopPropagation()"
              (change)="toggleSelection(report.id)">
            </mat-checkbox>

            <div class="jensify-report-main">
              <div class="jensify-report-title">
                <span class="name">{{ report.name }}</span>
                <span class="employee" *ngIf="report.user?.full_name">
                  â€¢ {{ report.user?.full_name }} <span class="muted">({{ report.user?.email }})</span>
                </span>
              </div>
              <div class="jensify-report-meta">
                <span>Approved {{ formatDate(report.approved_at) }}</span>
                <span *ngIf="report.expense_count">{{ report.expense_count }} expenses</span>
              </div>
            </div>

            <div class="jensify-report-amount">
              {{ formatCurrency(report.total_amount || 0) }}
            </div>

            <div class="jensify-report-actions">
              <button mat-raised-button class="jensify-reimbursed-btn" (click)="markAsPaid(report.id); $event.stopPropagation();">
                <mat-icon>paid</mat-icon>
                Reimburse
              </button>
            </div>
          </div>
        }
      </div>
    </mat-card>
  }
</div>
