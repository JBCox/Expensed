<div class="jensify-container">
  <div class="jensify-page-header">
    <div class="jensify-header-content">
      <h1 class="jensify-page-title">Approval Queue</h1>
      <div class="jensify-summary-metrics">
        <div class="jensify-metric">
          <span class="jensify-metric-value">{{ totalPending() }}</span>
          <span class="jensify-metric-label">Submitted Reports</span>
        </div>
        <div class="jensify-metric">
          <span class="jensify-metric-value">{{ formatCurrency(totalAmount()) }}</span>
          <span class="jensify-metric-label">Total Amount</span>
        </div>
      </div>
    </div>

    @if (selectedCount() > 0) {
      <div class="jensify-batch-actions">
        <span class="jensify-selection-count">{{ selectedCount() }} selected</span>
        <button mat-raised-button class="jensify-approve-btn" (click)="approveSelected()">
          <mat-icon>done_all</mat-icon>
          Approve Selected
        </button>
        <button mat-stroked-button color="warn" (click)="rejectSelected()">
          <mat-icon>close</mat-icon>
          Reject Selected
        </button>
      </div>
    }
  </div>

  <mat-card class="jensify-card jensify-filters-card">
    <div class="jensify-filter-row">
      <mat-form-field appearance="fill" floatLabel="always" class="full-width">
        <mat-icon matPrefix>search</mat-icon>
        <mat-label>Search by report or employee</mat-label>
        <input matInput [(ngModel)]="searchQuery" (ngModelChange)="searchQuery.set($event)">
      </mat-form-field>
      <button mat-button (click)="clearFilters()">
        <mat-icon>clear</mat-icon>
        Clear
      </button>
    </div>
  </mat-card>

  @if (loading()) {
    <app-loading-skeleton />
  }

  @if (error() && !loading()) {
    <mat-card class="jensify-card error-card">
      <mat-icon>error</mat-icon>
      <p>{{ error() }}</p>
      <button mat-raised-button color="primary" (click)="loadSubmittedReports()">Retry</button>
    </mat-card>
  }

  @if (!loading() && !error() && filteredReports().length === 0) {
    <app-empty-state
      icon="celebration"
      title="All caught up!"
      message="No submitted reports to review.">
    </app-empty-state>
  }

  @if (!loading() && !error() && filteredReports().length > 0) {
    <mat-card class="jensify-card">
      <div class="jensify-report-list">
        @for (report of filteredReports(); track trackByReportId($index, report)) {
          <div class="jensify-report-row" (click)="toggleSelection(report.id)">
            <mat-checkbox
              [checked]="isSelected(report.id)"
              (click)="$event.stopPropagation()"
              (change)="toggleSelection(report.id)">
            </mat-checkbox>

            <div class="jensify-report-main">
              <div class="jensify-report-title">
                <span class="name">{{ report.name }}</span>
                <span class="employee" *ngIf="report.user?.full_name">
                  â€¢ {{ report.user?.full_name }} <span class="muted">({{ report.user?.email }})</span>
                </span>
              </div>
              <div class="jensify-report-meta">
                <span>Submitted {{ formatDate(report.submitted_at) }}</span>
                <span *ngIf="report.expense_count">{{ report.expense_count }} expenses</span>
              </div>
            </div>

            <div class="jensify-report-amount">
              {{ formatCurrency(report.total_amount || 0) }}
            </div>

            <div class="jensify-report-actions">
              <button mat-stroked-button color="warn" (click)="rejectReport(report.id); $event.stopPropagation();">
                <mat-icon>close</mat-icon>
                Reject
              </button>
              <button mat-raised-button class="jensify-approve-btn" (click)="approveReport(report.id); $event.stopPropagation();">
                <mat-icon>done</mat-icon>
                Approve
              </button>
            </div>
          </div>
        }
      </div>
    </mat-card>
  }
</div>
